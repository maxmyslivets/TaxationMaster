# Taxation Tool
### Инструменты для таксационных расчетов:
* Разработка плана удаления, пересадки зеленых насаждений
* Составление ведомостей удаляемых и пересаживаемых деревьев и кустарников
* Составление баланса существующих деревьев и кустарников
* Расчет объемов выхода древесины и древесных отходов по таблицам объемов стволов
* Расчет компенсации за удаляемые, пересаживаемые объекты растительного мира
* Составление ведомостей удаляемых цветников, газонов, иного травяного покрова
* Составление баланса существующих цветников, газонов, иного травяного покрова
* Составление планируемого баланса объектов растительного мира на территории объекта строительства
### Таблицы объемов стволов
* Таблица зависимости объема ствола от диаметра и высоты
### База данных
* Деревья и кустарники
* Классификация насаждений
* Плотность древесины

## Requirements
- Python == 3.11

# Описание процесса обработки

## Настройки
* *Работать в скрытых ячейках (медленно)*: Если включено, то, при выделении множества строк, программа будет обрабатывать
только видимые строки. Если нет необходимости в фильтрации скрытых строк, то рекомендуется отключить для повышения 
скорости обработки.
* *Начальный исх.номер*: Исходный номер точки, с которой будет производиться расчет расстояния при нумерации по 
ближайшим
* *Начальный номер*: Стартовый номер для присвоения его первой точке при нумерации по ближайшим
* *Производить пересадки древесно-кустарниковой растительности*: Если выключено, то при определении действия будет
всегда принято *Удаление*

## Работа с таблицей Ведомости

### Создание файла для работы с таблицами
1. Нажать *Новый Excel* для открытия подготовленного шаблона .xlsx файла в режиме чтения
2. Сохранить .xlsx файл в необходимую директорию

### Вставка данных ведомости таксации
#### Если ведомость представлена файлом .doc/.docx:
1. Находясь на листе *Ведомость* нажать *Импортировать ведомость*, если ведомость представляет файл .doc/.docx
2. Проверить совпадение данных с наименованием колонок первой строки
3. Удалить строку 2 и строку 3, если в файле ведомости таксации были заголовки таблицы
#### Если ведомость представлена файлом .xls/.xlsx:
1. Вручную ввести наименования колонок в первую строку листа *Ведомость*:
   `Индекс | Номер точки | Наименование | Количество | Высота | Толщина | Состояние | Кустарник | Валидация`
2. Выделить колонки с *Индекс* по *Состояние* и применить формат `Текстовый`
3. Перенести данные ведомости таксации в соответствии наименованием колонок таблицы
4. Заполнить колонку *Индекс* начиная с `0`.

### Создание переменной таблицы
Для удобства сортировки данных в процессе исправления ошибок необходимо выделить таблицу и создать переменную Excel
через команду *Вставка>Таблицы>Таблица*. Имя переменной не будет иметь значения при обработке.

### Изменение единиц измерения
#### Если колонка *Высота* или *Толщина* представлены в сантиметрах:
1. Выделить ячейки, которые необходимо конвертировать
2. Нажать *Перевод см в м*

### Определение кустарников
1. Выделить ячейки на строках, в которых нужно определить кустарник
2. Нажать *Определить кустарник*

Строки, в которых располагаются кустарники, будут обозначены в колонке *Кустарник* как `1`, или `0`, 
если растительность является деревом.

Если в строке вместо `1` или `0` появилась ошибка, значит в базе данных нет породы из колонки *Наименование*.

### Валидация
1. Выделить ячейки на строках, в которых нужно произвести проверку данных на корректность
2. Нажать *Проверить строку*

Строки, в которых данные не валидны, будут обозначены в колонке *Валидация* как `1`, или `0`, если ошибок нет.

### Исправление ошибок в данных
#### Если ошибки вызваны пунктуацией:
* Если вещественные числа обозначены с разделителем `,` вместо `.`, то для исправления можно применить команду 
  *Заменить Запятую на Точку* на выделенных ячейках.
* Если разделитель чисел `;` вместо `,`, то для исправления можно применить команду 
  *Заменить Точку с Запятой на Запятую* на выделенных ячейках.
### В иных случаях:
* Необходимо проверить целостность и корректность исходных данных

### Сжатие обозначений размеров высоты и толщины
Для сжатия занимаемого места при описании размеров можно применить команду *Сжать строку размеров* на выделенных 
ячейках, после чего обязательно произвести повторную валидацию данных

### Контрольная проверка
После всех манипуляций с исправлением данных, проверить видимость всех строк и повторно произвести валидацию данных 
на всех строках

## Работа с чертежом геодезической таксации

### Создание .dwg файла для работы с таксацией
1. Нажать *Новый Autocad*, после чего откроется проводник и будет выделен необходимый для открытия .dwg файл
2. Открыть *template.dwg* в режиме чтения
3. Сохранить .dwg файл в необходимую директорию

### Преобразование объектов Autocad для дальнейшей обработки
1. В модели топографического плана выделить номера таксации и перенести на слой *номера*
2. В модели топографического плана преобразовать контуры таксации в замкнутые полилинии и перенести на слой *контуры*
3. В модели топографического плана полосы таксации очертить полилиниями и перенести на слой *полосы*
4. Перенести номера, контуры и полосы из модели топографического плана в модель подготовленного шаблона.
   Для удобства рекомендуется перенести также объекты растительности со слоя *Растительный покров и грунты*
5. В листе задания от генплана (далее ГП) выделить зоны (при необходимости обозначить внутренние полигоны зон) и 
перенести в пространство модели через команду *СМЕНАПРОСТР*
6. В модели задания от ГП зоны перенести на слой *зоны*
7. Внешние границы зон подписываются на слое *зоны* с помощью объекта *МТекст* названием зоны, а внутренние зоны, 
при их наличии, подписываются так же, но в конце ставится знак `_`. Точки вставки подписей должны быть привязаны к 
любой вершине полилинии зоны, для границ накладывающихся друг на друга допускается добавлять вершины для выноски при 
условии, что увеличение площади полигона зоны будет нулевым
8. В листе задания от ГП выделить охранные зоны и перенести в пространство модели через команду *СМЕНАПРОСТР*
9. В модели задания от ГП охранные зоны перенести на слой *охранные зоны*
10. Перенести данные зон из модели задания от ГП в модель подготовленного шаблона

### Сравнение данных чертежа и ведомости
1. Для проверки наличия и сходства номеров в ведомости и чертеже выполнить команду *Сравнить номера*

В консольном выводе программы отобразятся списки дубликатов номеров и номеров, которые имеются в одном из источников.
При поиске дубликатов в учет не берется повтор номеров для контуров, поэтому рекомендуется изначально убрать данные 
дубликаты. После исправления необходимо провести повторную проверку.

### Вставка данных таксации из Autocad в таблицу
1. Находясь в листе *Автокад* выполнить команду *Вставить данные с плана*
2. Находясь в листе *Зоны* выполнить команду *Вставить зоны*
3. Находясь в листе *Охранные зоны* выполнить команду *Вставить охранные зоны*

## Работа с Ведомостью ОРМ
1. Находясь в листе *Ведомость ОРМ* выполнить команду *Сформировать ведомость ОРМ*

Ведомость ОРМ (Ведомость объектов растительного мира) представляет собой ведомость с разделенными ОРМ по отдельным 
номерам.

## Разделение ОРМ по зонам

### Создание листа зоны
1. Создать пустой лист с именем зоны (необходимо точное совпадение)
2. Находясь в листе зоны выполнить команду *Вставить объекты для зоны*
3. Повторить шаги 1-2 для других зон

### Нумерация по ближайшим
1. В строку ввода программы *Начальный исх.номер* ввести стартовый номер точки из колонки *Исх.номер* листа зоны
2. В строку ввода программы *Начальный номер* ввести номер, с которого будет начинаться нумерация ОРМ для данной зоны
3. Находясь в листе зоны выполнить команду *Нумерация по ближайшим*
4Повторить шаги 1-2 для других зон

### Определить удаление и пересадки
1. Находясь в листе зоны выполнить команду *Определить действие*
2. Повторить шаг 1 для других зон

### Номер примечания
TODO: Добавить колонку *Примечание* в лист зоны. В методе экспорта таблицы добавить функционал для форматирования 
содержания примечания

## Экспорт данных в Autocad

### Экспорт номеров
Экспорт выносок номеров и условных обозначений удаляемых и пересаживаемых ОРМ в .dxf файл
1. Создать временный чертеж для форматирования выносок
2. Находясь в листе зоны выполнить команду *Экспорт номеров из зоны в DXF*
3. Открыть указанный .dxf файл и скопировать объекты во временный чертеж
4. Повторить шаги 2-3 для других зон
5. Выполнить команду *Новый Autocad* для открытия директории с шаблонами и открыть шаблон *template.dxf*
6. Скопировать стиль выноски из *template.dxf* и применить его к выноскам во временном чертеже
7. Перенести выноски и условные обозначения на лист ГП с требуемым изменением масштаба
8. Произвести ручное разнесение полок выносок для читаемости таксационного плана
9. При необходимости перенести некоторые условные обозначения к центрам словных знаков деревьев на 
топографической подложке

### Экспорт таблицы существующих деревьев
1. Создать временный чертеж для вставки таблиц
2. Создать переменную таблицы через команду Excel *Вставка>Таблицы>Таблица* для сортировки
3. Произвести сортировку `Сортировка по возрастанию` по колонке *Номер*
4. Находясь в активном чертеже и листе зоны выполнить команду *Вставка таблицы сущ. из зоны в Autocad*
5. TODO: Произвести форматирование таблицы
6. Перенести таблицу в другой временный чертеж для компоновки таблиц
7. 